<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shower Presentation Engine</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="html_renderer/shower/themes/ribbon/styles/screen-16x10.css">
    <link rel="stylesheet" href="html_renderer/highlight/github_color_scheme.css">
</head>
<body class="shower list">

<header class="caption">
    <h1>Фогстрим лекцции</h1>
    <p>Функции</p>
</header>

<h1>Основы баз данных</h1>
<section class="slide"><h2>Основы баз данных</h2>
</section><section class="slide"><h2>Немного терминологии</h2>
<p>Атрибут — свойство некоторой сущности. Часто называется полем таблицы.</p>
<p>Домен атрибута — множество допустимых значений, которые может принимать атрибут.</p>
</section><section class="slide"><h2>Немного терминологии</h2>
<p>Кортеж — конечное множество взаимосвязанных допустимых значений атрибутов, которые вместе описывают некоторую сущность (строка таблицы).</p>
<p>Отношение — конечное множество кортежей (таблица).</p>
</section><section class="slide"><h2>Немного терминологии</h2>
<p>Схема отношения — конечное множество атрибутов, определяющих некоторую сущность. Иными словами, это структура таблицы, состоящей из конкретного набора полей.</p>
</section><section class="slide"><h2>Немного терминологии</h2>
<p>Нормальная форма — требование, предъявляемое к структуре таблиц в теории реляционных баз данных для устранения из базы избыточных функциональных зависимостей между атрибутами (полями таблиц).</p>
</section><section class="slide"><h2>Немного терминологии</h2>
<p>Метод нормальных форм (НФ) состоит в сборе информации о объектах решения задачи в рамках одного отношения и последующей декомпозиции этого отношения на несколько взаимосвязанных отношений на основе процедур нормализации отношений.</p>
</section><section class="slide"><h2>Цель нормализации</h2>
<p>Исключить избыточное дублирование данных, которое является причиной аномалий, возникших при добавлении, редактировании и удалении кортежей(строк таблицы).</p>
</section><section class="slide"><h2>Первая нормальная форма</h2>
<p>Первая нормальная форма (1НФ) - это обычное отношение. Отношение в 1НФ обладает следующими свойствами:</p>
<p>В отношении нет одинаковых кортежей.
Кортежи не упорядочены.
Атрибуты не упорядочены.
Все значения атрибутов атомарны.</p>
</section><section class="slide"><h2>Первая нормальная форма</h2>
<p><img src="./images/nf1_ex1.png" alt="nf1"></p>
</section><section class="slide"><h2>Первая нормальная форма</h2>
<p><img src="./images/nf1_ex2.png" alt="nf1"></p>
</section><section class="slide"><h2>Вторая нормальная форма</h2>
<p>Отношение находится во 2НФ, если оно находится в 1НФ и каждый не ключевой атрибут зависит от выбраного ключа.</p>
</section><section class="slide"><h2>Вторая нормальная форма</h2>
<p><img src="./images/nf2_ex1.png" alt="nf2"></p>
</section><section class="slide"><h2>Вторая нормальная форма</h2>
<p><img src="./images/nf2_ex2.png" alt="nf2"></p>
</section><section class="slide"><h2>Вторая нормальная форма</h2>
<p><img src="./images/nf2_ex3.png" alt="nf2"></p>
</section><section class="slide"><h2>Третья нормальная форма</h2>
<p>Отношение находится в 3НФ, когда находится во 2НФ и и все неключевые атрибуты взаимно независимы.</p>
</section><section class="slide"><h2>Третья нормальная форма</h2>
<p><img src="./images/nf3_ex1.png" alt="nf3"></p>
</section><section class="slide"><h2>Третья нормальная форма</h2>
<table>
<thead><tr>
<th>Магазин</th>
<th>Телефон</th>
</tr>
</thead>
<tbody>
<tr>
<td>Риал-авто</td>
<td>87-33-98</td>
</tr>
<tr>
<td>Некст-Авто</td>
<td>94-54-12</td>
</tr>
</tbody>
</table>
</section><section class="slide"><h2>Третья нормальная форма</h2>
<p><img src="./images/nf3_ex2.png" alt="nf3"></p>
</section><section class="slide"><h2>Нормальная форма Бойса-Кодда (НФБК)</h2>
<p>Определение 3НФ не совсем подходит для следующих отношений:</p>
<ul>
<li>отношение имеет две или более потенциальных ключа;</li>
<li>два и более потенциальных ключа являются составными;</li>
<li>они пересекаются, т.е. имеют хотя бы один общий атрибут.</li>
</ul>
</section><section class="slide"><h2>Нормальная форма Бойса-Кодда (НФБК)</h2>
<p>Отношение  находится в нормальной форме Бойса-Кодда (НФБК) тогда и только тогда, когда значения всех функциональных зависимостей являются потенциальными ключами.</p>
</section><section class="slide"><h2>Нормальная форма Бойса-Кодда (НФБК)</h2>
<p>Предположим, рассматривается отношение, представляющее данные о бронировании стоянки на день</p>
</section><section class="slide"><h2>Нормальная форма Бойса-Кодда (НФБК)</h2>
<p><img src="./images/nf3D_ex1.png" alt="nf3D"></p>
</section><section class="slide"><h2>Нормальная форма Бойса-Кодда (НФБК)</h2>
<p><img src="./images/nf3D_ex2.png" alt="nf3D"></p>
</section><section class="slide"><h2>Нормальная форма Бойса-Кодда (НФБК)</h2>
<p><img src="./images/nf3D_ex3.png" alt="nf3D"></p>
</section><section class="slide"><h2>Четвертая нормальная форма</h2>
<p>Отношение находится в 4НФ, если оно находится в НФБК и все нетривиальные многозначные зависимости фактически являются функциональными зависимостями от ее потенциальных ключей.</p>
</section><section class="slide"><h2>Четвертая нормальная форма</h2>
<p>Предположим, что рестораны производят разные виды пиццы, а службы доставки ресторанов работают только в определенных районах города.</p>
</section><section class="slide"><h2>Четвертая нормальная форма</h2>
<p>Такая переменная отношения не соответствует 4НФ, так как существует следующая многозначная зависимость:</p>
<p>{Ресторан} → {Вид пиццы}</p>
<p>{Ресторан} → {Район доставки}</p>
</section><section class="slide"><h2>Четвертая нормальная форма</h2>
<p>Декомпозиция:</p>
<pre><code>({Ресторан, Вид пиццы, Район доставки} → Цена)
</code></pre>
</section><section class="slide"><h2>Пятая нормальная форма</h2>
<p>Отношения находятся в 5НФ, если оно находится в 4НФ и отсутствуют сложные зависимые соединения между атрибутами.</p>
<p>Если «Атрибут зависит от «Атрибута_2», а «Атрибут_2» в свою очередь зависит от «Атрибута_3», а «Атрибут_3» зависит от «Атрибута_1», то все три атрибута обязательно входят в один кортеж.</p>
</section><section class="slide"><h2>Шестая нормальная форма</h2>
<p>Переменная находится в 6НФ тогда и только тогда, когда она неприводима, то есть не может быть подвергнута дальнейшей декомпозиции без потерь.</p>
</section><section class="slide"><h2>Шестая нормальная форма</h2>
<p><img src="./images/nf6_ex1.png" alt="nf6"></p>
</section><section class="slide"><h2>Шестая нормальная форма</h2>
<p><img src="./images/nf6_ex2.png" alt="nf6"></p>
</section><section class="slide"><h2>Шестая нормальная форма</h2>
<p><img src="./images/nf6_ex3.png" alt="nf6"></p>
</section><section class="slide"><h2>Вопросы</h2>
</section><section class="slide"><h2>JOIN</h2>
<ul>
<li>INNER</li>
<li>LEFT</li>
<li>RIGHT</li>
<li>FULL OUTER JOIN</li>
<li>CROSS JOIN</li>
<li>Natural JOIN</li>
<li>UPDATE JOIN</li>
</ul>
</section><section class="slide"><h2>JOIN</h2>
<pre><code>SELECT
  a.col1
  b.col1
FROM
  table1 AS a [INNER, LEFT, RIGHT ....] JOIN table2 AS b
  ON a.id = b.id [(AND|OR) condition....]
</code></pre>
</section><section class="slide"><h2>INNER JOIN</h2>
<p><img src="./images/inner_ex1.png" alt="inner"></p>
</section><section class="slide"><h2>INNER JOIN</h2>
<pre><code>SELECT
 A.pka,
 A.c1,
 B.pkb,
 B.c2
FROM
 A
INNER JOIN B ON A .pka = B.fka;
</code></pre>
</section><section class="slide"><h2>INNER JOIN</h2>
<p><img src="./images/inner_diag.png" alt="inner_diag"></p>
</section><section class="slide"><h2>Две таблицы</h2>
<p><img src="./images/inner_ex2.png" alt="inner_ex2"></p>
</section><section class="slide"><h2>Две таблицы</h2>
<pre><code>SELECT
 customer.customer_id,
 first_name,
 last_name,
 email,
 amount,
 payment_date
FROM
 customer
INNER JOIN payment ON payment.customer_id = customer.customer_id;
</code></pre>
</section><section class="slide"><h2>Три таблицы</h2>
<p><img src="./images/inner_ex3.png" alt="inner_ex3"></p>
</section><section class="slide"><h2>Три таблицы</h2>
<pre><code>SELECT
 customer.customer_id,
 customer.first_name customer_first_name,
 customer.last_name customer_last_name,
 customer.email,
 staff.first_name staff_first_name,
 staff.last_name staff_last_name,
 amount,
 payment_date
FROM
 customer
INNER JOIN payment ON payment.customer_id = customer.customer_id
INNER JOIN staff ON payment.staff_id = staff.staff_id;
</code></pre>
</section><section class="slide"><h2>LEFT</h2>
<pre><code>SELECT
 A.pka,
 A.c1,
 B.pkb,
 B.c2
FROM
 A
LEFT JOIN B ON A .pka = B.fka;
</code></pre>
</section><section class="slide"><h2>LEFT</h2>
<p><img src="./images/left_ex1.png" alt="left_ex1"></p>
</section><section class="slide"><h2>LEFT</h2>
<p><img src="./images/left_ex2.png" alt="left_ex2"></p>
</section><section class="slide"><h2>LEFT</h2>
<pre><code>SELECT
 film.film_id,
 film.title,
 inventory_id
FROM
 film
LEFT JOIN inventory ON inventory.film_id = film.film_id;
</code></pre>
</section><section class="slide"><h2>RIGHT</h2>
<p>То же что и LEFT, только RIGHT</p>
</section><section class="slide"><h2>FULL OUTER</h2>
<pre><code>SELECT * FROM A
FULL [OUTER] JOIN B on A.id = B.id;
</code></pre>
</section><section class="slide"><h2>FULL OUTER</h2>
<p><img src="./images/full_ex1.png" alt="full_ex1"></p>
</section><section class="slide"><h2>FULL OUTER</h2>
<pre><code># SELECT * FROM departments;
 department_id | department_name
---------------+-----------------
             1 | Sales
             2 | Marketing
             3 | HR
             4 | IT
             5 | Production
(5 rows)
</code></pre>
</section><section class="slide"><h2>FULL OUTER</h2>
<pre><code># SELECT * FROM employees;
 employee_id |  employee_name  | department_id
-------------+-----------------+---------------
           1 | Bette Nicholson |             1
           2 | Christian Gable |             1
           3 | Joe Swank       |             2
           4 | Fred Costner    |             3
           5 | Sandra Kilmer   |             4
           6 | Julia Mcqueen   |
(6 rows)
</code></pre>
</section><section class="slide"><h2>FULL OUTER</h2>
<pre><code>SELECT
 employee_name,
 department_name
FROM
 employees e
FULL OUTER JOIN departments d ON d.department_id = e.department_id;
</code></pre>
</section><section class="slide"><h2>FULL OUTER</h2>
<pre><code>employee_name  | department_name
—---------------+---------------—
 Bette Nicholson | Sales
 Christian Gable | Sales
 Joe Swank       | Marketing
 Fred Costner    | HR
 Sandra Kilmer   | IT
 Julia Mcqueen   | NULL
 NULL            | Production
</code></pre>
</section><section class="slide"><h2>CROSS</h2>
<pre><code>CREATE TABLE T1 (label CHAR(1) PRIMARY KEY);

CREATE TABLE T2 (score INT PRIMARY KEY);
</code></pre>
</section><section class="slide"><h2>CROSS</h2>
<pre><code>INSERT INTO T1 (label)
VALUES
 ('A'),
 ('B');

INSERT INTO T2 (score)
VALUES
 (1),
 (2),
 (3);
</code></pre>
</section><section class="slide"><h2>CROSS</h2>
<pre><code>SELECT
 *
FROM
 T1
CROSS JOIN T2;
</code></pre>
</section><section class="slide"><h2>CROSS</h2>
<p><img src="./images/cross_ex1.png" alt="cross_ex1"></p>
</section><section class="slide"><h2>CROSS</h2>
<p>Тоже самое</p>
<pre><code>SELECT *
FROM T1, T2;
</code></pre>
<pre><code>SELECT *
FROM T1
INNER JOIN T2 ON TRUE;
</code></pre>
</section><section class="slide"><h2>NATURAL</h2>
<pre><code>SELECT *
FROM T1
NATURAL [INNER, LEFT, RIGHT] JOIN T2;
</code></pre>
</section><section class="slide"><h2>NATURAL</h2>
<p><img src="./images/natural_ex1.png" alt="natural_ex1"></p>
</section><section class="slide"><h2>NATURAL</h2>
<pre><code>CREATE TABLE categories (
 category_id serial PRIMARY KEY,
 category_name VARCHAR (255) NOT NULL
);

CREATE TABLE products (
 product_id serial PRIMARY KEY,
 product_name VARCHAR (255) NOT NULL,
 category_id INT NOT NULL,
 FOREIGN KEY (category_id) REFERENCES category (category_id)
);
</code></pre>
</section><section class="slide"><h2>NATURAL</h2>
<pre><code>SELECT
 *
FROM
 products
NATURAL JOIN categories;
</code></pre>
</section><section class="slide"><h2>NATURAL</h2>
<pre><code>category_id | product_id |  product_name   | category_name
-------------+------------+-----------------+---------------
           1 |          1 | iPhone          | Smart Phone
           1 |          2 | Samsung Galaxy  | Smart Phone
           2 |          3 | HP Elite        | Laptop
           2 |          4 | Lenovo Thinkpad | Laptop
           3 |          5 | iPad            | Tablet
           3 |          6 | Kindle Fire     | Tablet
(6 rows)
</code></pre>
</section><section class="slide"><h2>UPDATE JOIN</h2>
<pre><code>UPDATE A
SET A.c1 = expresion
FROM B
WHERE A.c2 = B.c2;
</code></pre>
</section><section class="slide"><h2>UPDATE JOIN</h2>
<p><img src="./images/update_ex1.png" alt="update_ex1"></p>
</section><section class="slide"><h2>UPDATE JOIN</h2>
<pre><code>UPDATE product
SET net_price = price - price * discount
FROM
product_segment
WHERE
product.segment_id = product_segment.id;
</code></pre>
</section><section class="slide"><h2>Вопросы</h2>
</section><section class="slide"><h2>ORDER BY</h2>
<pre><code>SELECT
 column_1,
 column_2
FROM
 tbl_name
ORDER BY
 column_1 ASC,
 column_2 DESC;
</code></pre>
</section><section class="slide"><h2>ORDER BY</h2>
<p><img src="./images/order_ex1.png" alt="order_ex1"></p>
</section><section class="slide"><h2>ORDER BY</h2>
<pre><code>SELECT
 first_name,
 last_name
FROM
 customer
ORDER BY
 first_name ASC,
 last_name DESC;
</code></pre>
</section><section class="slide"><h2>ORDER BY</h2>
<p><img src="./images/order_ex2.png" alt="order_ex2"></p>
</section><section class="slide"><h2>Виды агрегатных функции</h2>
<ul>
<li>Агрегатные функции общего назначения (min, max, avg, ...)</li>
<li>Агрегатные функции для статистических вычислений (corr, regr_avg, regr_syy, ...)</li>
<li>Сортирующие агрегатные функции(mode, percentile_cont, ...)</li>
<li>Гипотезирующие агрегатные функции (rank, dense, ...)</li>
<li>Операции группировки ( grouping )</li>
</ul>
</section><section class="slide"><h2>Агрегатные функции</h2>
<pre><code>SELECT count(*) FROM sometable;
</code></pre>
</section><section class="slide"><h2>Пример</h2>
<pre><code>SELECT * FROM items_sold;
 make  | model | sales
-------+-------+-------
 Foo   | GT    |  10
 Foo   | Tour  |  20
 Bar   | City  |  15
 Bar   | Sport |  5
(4 rows)
</code></pre>
</section><section class="slide"><h2>Пример</h2>
<pre><code>SELECT make, model, GROUPING(make,model), sum(sales) FROM items_sold GROUP BY ROLLUP(make,model);
 make  | model | grouping | sum
-------+-------+----------+-----
 Foo   | GT    |        0 | 10
 Foo   | Tour  |        0 | 20
 Bar   | City  |        0 | 15
 Bar   | Sport |        0 | 5
 Foo   |       |        1 | 30
 Bar   |       |        1 | 20
       |       |        3 | 50
(7 rows)
</code></pre>
</section><section class="slide"><h2>GROUP BY</h2>
<pre><code>SELECT column_1, aggregate_function(column_2)
FROM tbl_name
GROUP BY column_1;
</code></pre>
</section><section class="slide"><h2>GROUP BY</h2>
<p><img src="./images/group_ex1.png" alt="group_ex1"></p>
</section><section class="slide"><h2>Пример</h2>
<pre><code>SELECT
 customer_id,
 SUM (amount)
FROM
 payment
GROUP BY
 customer_id;
</code></pre>
</section><section class="slide"><h2>Пример GROUP BY и ORDER BY</h2>
<pre><code>SELECT
 customer_id,
 SUM (amount)
FROM
 payment
GROUP BY
 customer_id
ORDER BY
 SUM (amount) DESC;
</code></pre>
</section><section class="slide"><h2>HAVING</h2>
<pre><code>SELECT
 column_1,
 aggregate_function (column_2)
FROM
 tbl_name
GROUP BY
 column_1
HAVING
 condition;
</code></pre>
</section><section class="slide"><h2>HAVING</h2>
<p><img src="./images/having_ex1.png" alt="having_ex1"></p>
</section><section class="slide"><h2>HAVING</h2>
<pre><code>SELECT
 customer_id,
 SUM (amount)
FROM
 payment
GROUP BY
 customer_id
HAVING
 SUM (amount) &gt; 200;
</code></pre>
</section><section class="slide"><h2>Вопросы</h2>
</section><section class="slide"><h2>Операции объединения</h2>
<ul>
<li>UNION</li>
<li>INTERSECT</li>
<li>EXCEPT</li>
</ul>
</section><section class="slide"><h2>UNION</h2>
<pre><code>SELECT
 column_1,
 column_2
FROM
 tbl_name_1
UNION
SELECT
 column_1,
 column_2
FROM
 tbl_name_2;
</code></pre>
</section><section class="slide"><h2>UNION</h2>
<pre><code>SELECT *
FROM
 sales2007q1
UNION
SELECT *
FROM
 sales2007q2;
</code></pre>
</section><section class="slide"><h2>UNION ALL</h2>
<pre><code>SELECT *
FROM
 sales2007q1
UNION ALL
SELECT *
FROM
 sales2007q2;
</code></pre>
</section><section class="slide"><h2>INTERSECT</h2>
<p><img src="./images/intersect.png" alt="intersect"></p>
</section><section class="slide"><h2>INTERSECT</h2>
<pre><code>SELECT
 column_list
FROM
 A
INTERSECT
SELECT
 column_list
FROM
 B;
</code></pre>
</section><section class="slide"><h2>Пример</h2>
<pre><code>CREATE TABLE employees (
 employee_id serial PRIMARY KEY,
 employee_name VARCHAR (255) NOT NULL
);

CREATE TABLE keys (
 employee_id INT PRIMARY KEY,
 effective_date DATE NOT NULL,
 FOREIGN KEY (employee_id) REFERENCES employees (employee_id)
);

CREATE TABLE hipos (
 employee_id INT PRIMARY KEY,
 effective_date DATE NOT NULL,
 FOREIGN KEY (employee_id) REFERENCES employees (employee_id)
);
</code></pre>
</section><section class="slide"><h2>Пример</h2>
<pre><code>SELECT
 employee_id
FROM
 keys
INTERSECT
SELECT
        employee_id
FROM
 hipos;
</code></pre>
</section><section class="slide"><h2>Пример</h2>
<pre><code>employee_id
-------------
           5
           2
(2 rows)
</code></pre>
</section><section class="slide"><h2>EXPECT</h2>
<p><img src="./images/expect_ex1.png" alt="expect_ex1"></p>
</section><section class="slide"><h2>EXPECT</h2>
<pre><code>SELECT column_list
FROM A
WHERE condition_a
EXCEPT
SELECT column_list
FROM B
WHERE condition_b;
</code></pre>
</section><section class="slide"><h2>Пример c INNER JOIN</h2>
<pre><code>SELECT
 distinct inventory.film_id,
 title
FROM
 inventory
INNER JOIN film ON film.film_id = inventory.film_id
ORDER BY title;
</code></pre>
</section><section class="slide"><h2>Пример с EXPECT</h2>
<pre><code>SELECT
 film_id,
 title
FROM
 film
EXCEPT
 SELECT
 DISTINCT inventory.film_id,
 title
 FROM
 inventory
 INNER JOIN film ON film.film_id = inventory.film_id
</code></pre>
</section><section class="slide"><h2>Вопросы</h2>
</section><section class="slide"></section>

<div class="progress"></div>

<script src="html_renderer/shower/shower.min.js"></script>
<script src="html_renderer/highlight/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!-- Copyright © 2017 Yours Truly, Famous Inc. -->

</body>
</html>

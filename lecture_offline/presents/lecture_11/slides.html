<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shower Presentation Engine</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="html_renderer/shower/themes/ribbon/styles/screen-16x10.css">
    <link rel="stylesheet" href="html_renderer/highlight/github_color_scheme.css">
    <style>
        li {
            font-size: 24px;
        }
        pre {
            font-size: 24px;
        }
    </style>
</head>
<body class="shower list">

<header class="caption">
    <h1>Фогстрим лекцции</h1>
    <p>Функции</p>
</header>

<h1>TV</h1>
<section class="slide"><h2>TV</h2>
</section>
<section class="slide"><h2>Templates - Views</h2>
</section>
<section class="slide"><h2>Views</h2>
    <ul>
        <li>Это функции</li>
    </ul>
</section>
<section class="slide"><h2>Views</h2>
    <ul>
        <li>Это функции</li>
        <li>Или классы</li>
    </ul>
</section>
<section class="slide"><h2>Views: суть</h2>
    <ul>
        <li>Принимают запрос - отдают ответ</li>
    </ul>
</section>
<section class="slide"><h2>Views: суть</h2>
    <ul>
        <li>Принимают запрос</li>
    </ul>
</section>
<section class="slide"><h2>Views: суть</h2>
    <ul>
        <li>Принимают запрос - КАК?!</li>
    </ul>
</section>
<section class="slide"><h2>Views</h2>
    <p style="text-align: center;"><img style=" width: 50%" src="./images/request.png" alt="requests"></p>
</section>
<section class="slide"><h2>Разбираемся</h2>
    <ul>
        <li>Куда пришел запрос и что происходит?</li>
    </ul>
</section>
<section class="slide"><h2>Data flow</h2>
</section>
<section class="slide"><h2>Data flow</h2>
    <ul>
        <li>WSGI</li>
    </ul>
</section>
<section class="slide"><h2>Data flow</h2>
    <ul>
        <li>WSGI</li>
        <li>Middleware</li>
    </ul>
</section>
<section class="slide"><h2>Data flow</h2>
    <ul>
        <li>WSGI</li>
        <li>Middleware</li>
        <li>View</li>
    </ul>
</section>
<section class="slide"><h2>WSGI</h2>
    <p>Прослойка между веб-сервером и веб-приложением</p>
</section>
<section class="slide"><h2>Middleware</h2>
    <ul>
        <li>Цепочка фильтров</li>
    </ul>
</section>
<section class="slide"><h2>Middleware</h2>
    <ul>
        <li>Могут обрабатывать поток данных как в одном направлении, так и в обратном</li>
    </ul>
</section>
<section class="slide"><h2>Middleware</h2>
    <ul>
        <li>Это класс</li>
    </ul>
</section>
<section class="slide"><h2>Middleware</h2>
    <ul>
        <li>Это класс</li>
        <li>Реализуют некоторые из методов:</li>
        <li><code>process_request</code></li>
        <li><code>process_view</code></li>
        <li><code>process_exception</code></li>
        <li><code>process_response</code></li>
    </ul>
</section>
<section class="slide"><h2><code>process_request</code></h2>
    <ul>
        <li>Обрабатывает HTTP-запрос, возвращает объект HttpRequest</li>
    </ul>
</section>
<section class="slide"><h2>Остальные методы</h2>
    <ul>
        <li>Обрабатывают поведение views</li>
    </ul>
</section>
<section class="slide"><h2>Как понимать куда уйдет запрос?</h2>
</section>
<section class="slide"><h2>Как понимать куда уйдет запрос?</h2>
    <ul>
        <li>Url dispatcher или <code>UrlConf</code></li>
    </ul>
</section>
<section class="slide"><h2>UrlConf</h2>
    <pre><code class="lang-python" style="font-size: 20px">from django.urls import path

from . import views

urlpatterns = [
    path(&#39;articles/2003/&#39;, views.special_case_2003),
    path(&#39;articles/&lt;int:year&gt;/&#39;, views.year_archive),
    path(&#39;articles/&lt;int:year&gt;/&lt;int:month&gt;/&#39;, views.month_archive),
    path(&#39;articles/&lt;int:year&gt;/&lt;int:month&gt;/&lt;slug:slug&gt;/&#39;,
        views.article_detail),
]
</code></pre>
</section>
<section class="slide"><h2><code>process_view</code></h2>
    <ul>
        <li>Список аргументов <br><code style="font-size: 20px">process_view(request, view_function, view_args, view_kwargs)</code></li>
    </ul>
</section>
<section class="slide"><h2>Middleware</h2>
    <ul>
        <li>Если возвращает <code>None</code> - вызов следующей</li>
        <li>Если возращает <code>HttpResponse</code> завершаются</li>
    </ul>
</section>
<section class="slide"><h2>Views</h2>
    <pre><code class="lang-python">from django.http import HttpResponse
import datetime

def current_datetime(request):
    now = datetime.datetime.now()
    html = &quot;&lt;html&gt;&lt;body&gt;It is now %s.&lt;/body&gt;&lt;/html&gt;&quot; % now
    return HttpResponse(html)
</code></pre>
</section>
<section class="slide"><h2>Http</h2>
    <pre><code class="lang-python">import django.http
</code></pre>
</section>
<section class="slide"><h2>Http</h2>
    <ul>
        <li>А что если у нас есть html-документ?</li>
    </ul>
</section>
<section class="slide"><h2>TemplateResponse</h2>
    <pre><code class="lang-python">from django.template.response import TemplateResponse

def blog_index(request):
    return TemplateResponse(request, &#39;entry_list.html&#39;, {
        'entries&#39;: Entry.objects.all()
        })
</code></pre>
</section>
<section class="slide"><h2>TemplateResponse</h2>
    <ul>
        <li>Перед тем как возращается instance объекта, происходит рендеринг</li>
    </ul>
</section>
<section class="slide"><h2>TemplateResponse</h2>
    <ul>
        <li>Перед тем как возращается instance объекта, происходит рендеринг</li>
        <li>Весь контент будет лежать в TemplateResponse.content</li>
    </ul>
</section>
<section class="slide"><h2>Однако</h2>
    <ul>
        <li>Рендеринг произойдет один раз</li>
    </ul>
</section>
<section class="slide"><h2>Однако</h2>
    <pre><code class="lang-python">&gt;&gt;&gt; from django.template.response import TemplateResponse
&gt;&gt;&gt; t = TemplateResponse(request, &#39;original.html&#39;, {})
&gt;&gt;&gt; t.render()
&gt;&gt;&gt; print(t.content)
Original content

&gt;&gt;&gt; t.template_name = &#39;new.html&#39;
&gt;&gt;&gt; t.render()
&gt;&gt;&gt; print(t.content)
Original content
</code></pre>
</section>
<section class="slide"><h2>Как решать?!</h2>
</section>
<section class="slide"><h2>Как решать?!</h2>
    <ul>
        <li>Использовать <code>django.shortcut</code></li>
    </ul>
</section>
<section class="slide"><h2>render()</h2>
    <pre><code class="lang-python">from django.shortcuts import render

def my_view(request):
    # View code here...
    return render(request, &#39;myapp/index.html&#39;, {
        &#39;foo&#39;: &#39;bar&#39;,
    }, content_type=&#39;application/xhtml+xml&#39;)
</code></pre>
</section>
<section class="slide"><h2>Аналогично</h2>
    <pre><code class="lang-python">from django.http import HttpResponse
from django.template import loader

def my_view(request):
    # Что-то сделали...
    t = loader.get_template(&#39;myapp/index.html&#39;)
    c = {&#39;foo&#39;: &#39;bar&#39;}
    return HttpResponse(t.render(c, request),
        content_type=&#39;application/xhtml+xml&#39;)
</code></pre>
</section>
<section class="slide"><h2>Время практики</h2>
</section>
<section class="slide"></section>

<div class="progress"></div>

<script src="html_renderer/shower/shower.min.js"></script>
<script src="html_renderer/highlight/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!-- Copyright © 2017 Yours Truly, Famous Inc. -->

</body>
</html>
